{% extends "base.html" %}

{% block content %}
<h1>üéØ –ò–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–µ–Ω –ø—Ä–µ–≤–æ–¥–∞—á</h1>
<p class="lead">–ü—Ä–µ–≤–µ–∂–¥–∞–π—Ç–µ —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω–∏ –µ–∑–∏—Ü–∏ –≤ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ —Å –ø–æ–º–æ—â—Ç–∞ –Ω–∞ AI —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏.</p>

<div class="translator-container">
    <div class="input-section">
        <div class="form-group">
            <label for="textToTranslate">üìù –¢–µ–∫—Å—Ç –∑–∞ –ø—Ä–µ–≤–æ–¥:</label>
            <textarea
                id="textToTranslate"
                placeholder="–í—ä–≤–µ–¥–µ—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –µ–∑–∏–∫..."
                rows="4"
                oninput="updateCharCount()"
            ></textarea>
            <div class="char-count" style="text-align: right; font-size: 0.875rem; color: #666; margin-top: 0.5rem;">
                <span id="charCount">0</span> –∑–Ω–∞–∫–∞
            </div>
        </div>

        <div class="form-group">
            <label for="targetLanguage">üéØ –¶–µ–ª–µ–≤ –µ–∑–∏–∫:</label>
            <select id="targetLanguage">
                <option value="en">üá∫üá∏ –ê–Ω–≥–ª–∏–π—Å–∫–∏</option>
                <option value="es">üá™üá∏ –ò—Å–ø–∞–Ω—Å–∫–∏</option>
                <option value="fr">üá´üá∑ –§—Ä–µ–Ω—Å–∫–∏</option>
                <option value="de">üá©üá™ –ù–µ–º—Å–∫–∏</option>
                <option value="it">üáÆüáπ –ò—Ç–∞–ª–∏–∞–Ω—Å–∫–∏</option>
                <option value="ru">üá∑üá∫ –†—É—Å–∫–∏</option>
            </select>
        </div>

        <div class="action-buttons" style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <button onclick="translateText()" class="btn" id="translateBtn">
                üîÑ –ü—Ä–µ–≤–µ–¥–∏
            </button>
            <button onclick="clearText()" class="btn btn-secondary">
                üóëÔ∏è –ò–∑—á–∏—Å—Ç–∏
            </button>
            <button onclick="speakText()" class="btn btn-success" id="speakBtn">
                üîä –ì–ª–∞—Å–æ–≤–æ –≤—ä–∑–ø—Ä–æ–∏–∑–≤–µ–∂–¥–∞–Ω–µ
            </button>
        </div>
    </div>

    <div class="output-section">
        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1rem;">
            <h3 style="margin: 0;">üìä –†–µ–∑—É–ª—Ç–∞—Ç:</h3>
            <button onclick="copyTranslation()" class="btn" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                üìã –ö–æ–ø–∏—Ä–∞–π
            </button>
        </div>
        <div id="translationResult" class="result-box">
            <div class="placeholder-text" style="text-align: center; color: #999; padding: 2rem;">
                üëÜ –í—ä–≤–µ–¥–µ—Ç–µ —Ç–µ–∫—Å—Ç –∏ —â–µ –≤–∏–¥–∏—Ç–µ –ø—Ä–µ–≤–æ–¥–∞ —Ç—É–∫
            </div>
        </div>

        <div id="translationDetails" class="translation-details" style="margin-top: 1rem; display: none;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.875rem;">
                <div>
                    <strong>üìù –û—Ä–∏–≥–∏–Ω–∞–ª–µ–Ω —Ç–µ–∫—Å—Ç:</strong>
                    <span id="originalText"></span>
                </div>
                <div>
                    <strong>üéØ –¶–µ–ª–µ–≤ –µ–∑–∏–∫:</strong>
                    <span id="targetLangName"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="translation-examples" style="margin-top: 3rem;">
    <h3>üöÄ –ë—ä—Ä–∑–∏ –ø—Ä–∏–º–µ—Ä–∏:</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <button onclick="loadExample('–ó–¥—Ä–∞–≤–µ–π, –∫–∞–∫ —Å–∏?')" class="btn" style="padding: 0.75rem; font-size: 0.9rem;">
            üëã –ó–¥—Ä–∞–≤–µ–π, –∫–∞–∫ —Å–∏?
        </button>
        <button onclick="loadExample('–ë–ª–∞–≥–æ–¥–∞—Ä—è –∑–∞ –ø–æ–º–æ—â—Ç–∞!')" class="btn" style="padding: 0.75rem; font-size: 0.9rem;">
            üôè –ë–ª–∞–≥–æ–¥–∞—Ä—è –∑–∞ –ø–æ–º–æ—â—Ç–∞!
        </button>
        <button onclick="loadExample('–ö–æ–ª–∫–æ –µ —á–∞—Å—ä—Ç?')" class="btn" style="padding: 0.75rem; font-size: 0.9rem;">
            ‚è∞ –ö–æ–ª–∫–æ –µ —á–∞—Å—ä—Ç?
        </button>
        <button onclick="loadExample('–ö—ä–¥–µ –µ –Ω–∞–π-–±–ª–∏–∑–∫–∞—Ç–∞ –∞–ø—Ç–µ–∫–∞?')" class="btn" style="padding: 0.75rem; font-size: 0.9rem;">
            üè• –ö—ä–¥–µ –µ –∞–ø—Ç–µ–∫–∞—Ç–∞?
        </button>
    </div>
</div>

<script>
// –ï–∑–∏—Ü–∏ –∑–∞ –ø–æ–∫–∞–∑–≤–∞–Ω–µ
const languages = {
    'en': 'üá∫üá∏ –ê–Ω–≥–ª–∏–π—Å–∫–∏',
    'es': 'üá™üá∏ –ò—Å–ø–∞–Ω—Å–∫–∏',
    'fr': 'üá´üá∑ –§—Ä–µ–Ω—Å–∫–∏',
    'de': 'üá©üá™ –ù–µ–º—Å–∫–∏',
    'it': 'üáÆüáπ –ò—Ç–∞–ª–∏–∞–Ω—Å–∫–∏',
    'ru': 'üá∑üá∫ –†—É—Å–∫–∏'
};

let currentTranslation = '';

function updateCharCount() {
    const textarea = document.getElementById('textToTranslate');
    const charCount = document.getElementById('charCount');
    charCount.textContent = textarea.value.length;
}

async function translateText() {
    const text = document.getElementById('textToTranslate').value.trim();
    const targetLang = document.getElementById('targetLanguage').value;
    const translateBtn = document.getElementById('translateBtn');
    const resultDiv = document.getElementById('translationResult');
    const detailsDiv = document.getElementById('translationDetails');

    if (!text) {
        showNotification('–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞ –ø—Ä–µ–≤–æ–¥', 'warning');
        return;
    }

    // –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ loading state
    translateBtn.innerHTML = '<span class="loading"></span> –ü—Ä–µ–≤–µ–∂–¥–∞–Ω–µ...';
    translateBtn.disabled = true;
    resultDiv.innerHTML = '<div style="text-align: center; padding: 2rem;"><span class="loading"></span><br>–ü—Ä–µ–≤–µ–∂–¥–∞–º–µ —Ç–µ–∫—Å—Ç–∞...</div>';

    try {
        const response = await fetch(`/api/v1/translate/${encodeURIComponent(text)}?target_lang=${targetLang}`);

        if (!response.ok) {
            throw new Error(`–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—è–≤–∫–∞—Ç–∞: ${response.status}`);
        }

        const data = await response.json();
        currentTranslation = data.translated;

        // –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞
        resultDiv.innerHTML = `
            <div style="font-size: 1.2rem; line-height: 1.6; margin-bottom: 1rem;">
                ${data.translated}
            </div>
            <div style="border-top: 1px solid #e9ecef; padding-top: 1rem; font-size: 0.9rem; color: #666;">
                <strong>üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–∞–∑–ø–æ–∑–Ω–∞–≤–∞–Ω–µ –Ω–∞ –µ–∑–∏–∫</strong>
            </div>
        `;

        // –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ –¥–µ—Ç–∞–π–ª–∏
        detailsDiv.style.display = 'block';
        document.getElementById('originalText').textContent = data.original;
        document.getElementById('targetLangName').textContent = languages[data.target_lang] || data.target_lang;

        showNotification('‚úÖ –ü—Ä–µ–≤–æ–¥—ä—Ç –µ —É—Å–ø–µ—à–µ–Ω!', 'success');

    } catch (error) {
        console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤–æ–¥:', error);
        resultDiv.innerHTML = `
            <div style="color: #dc3545; text-align: center; padding: 2rem;">
                <strong>‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤–æ–¥</strong>
                <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">${error.message}</p>
                <button onclick="retryTranslation()" class="btn" style="margin-top: 1rem; padding: 0.5rem 1rem;">
                    üîÑ –û–ø–∏—Ç–∞–π –æ—Ç–Ω–æ–≤–æ
                </button>
            </div>
        `;
        showNotification('‚ùå –í—ä–∑–Ω–∏–∫–Ω–∞ –≥—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤–æ–¥–∞', 'error');
    } finally {
        translateBtn.innerHTML = 'üîÑ –ü—Ä–µ–≤–µ–¥–∏';
        translateBtn.disabled = false;
    }
}

function retryTranslation() {
    translateText();
}

function clearText() {
    document.getElementById('textToTranslate').value = '';
    document.getElementById('translationResult').innerHTML = `
        <div class="placeholder-text" style="text-align: center; color: #999; padding: 2rem;">
            üëÜ –í—ä–≤–µ–¥–µ—Ç–µ —Ç–µ–∫—Å—Ç –∏ —â–µ –≤–∏–¥–∏—Ç–µ –ø—Ä–µ–≤–æ–¥–∞ —Ç—É–∫
        </div>
    `;
    document.getElementById('translationDetails').style.display = 'none';
    document.getElementById('charCount').textContent = '0';
    showNotification('‚úÖ –¢–µ–∫—Å—Ç—ä—Ç –µ –∏–∑—á–∏—Å—Ç–µ–Ω', 'info');
}

function copyTranslation() {
    if (!currentTranslation) {
        showNotification('‚ùå –ù—è–º–∞ –ø—Ä–µ–≤–æ–¥ –∑–∞ –∫–æ–ø–∏—Ä–∞–Ω–µ', 'warning');
        return;
    }

    navigator.clipboard.writeText(currentTranslation).then(() => {
        showNotification('‚úÖ –ü—Ä–µ–≤–æ–¥—ä—Ç –µ –∫–æ–ø–∏—Ä–∞–Ω –≤ –∫–ª–∏–ø–±–æ—Ä–¥–∞!', 'success');
    }).catch(err => {
        console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–∞–Ω–µ:', err);
        showNotification('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–∞–Ω–µ', 'error');
    });
}

function loadExample(text) {
    document.getElementById('textToTranslate').value = text;
    updateCharCount();
    showNotification(`‚úÖ –ó–∞—Ä–µ–¥–µ–Ω –ø—Ä–∏–º–µ—Ä: "${text}"`, 'info');
}

function speakText() {
    const text = document.getElementById('textToTranslate').value.trim();
    const speakBtn = document.getElementById('speakBtn');

    if (!text) {
        showNotification('–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞ –≥–ª–∞—Å–æ–≤–æ –≤—ä–∑–ø—Ä–æ–∏–∑–≤–µ–∂–¥–∞–Ω–µ', 'warning');
        return;
    }

    if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'bg-BG'; // –ë—ä–ª–≥–∞—Ä—Å–∫–∏ –µ–∑–∏–∫
        utterance.rate = 0.9;

        speakBtn.innerHTML = 'üîä –í—ä–∑–ø—Ä–æ–∏–∑–≤–µ–∂–¥–∞–Ω–µ...';
        speakBtn.disabled = true;

        utterance.onend = function() {
            speakBtn.innerHTML = 'üîä –ì–ª–∞—Å–æ–≤–æ –≤—ä–∑–ø—Ä–æ–∏–∑–≤–µ–∂–¥–∞–Ω–µ';
            speakBtn.disabled = false;
        };

        speechSynthesis.speak(utterance);
        showNotification('üîä –í—ä–∑–ø—Ä–æ–∏–∑–≤–µ–∂–¥–∞–Ω–µ –Ω–∞ —Ç–µ–∫—Å—Ç–∞...', 'info');
    } else {
        showNotification('‚ùå –í–∞—à–∏—è—Ç –±—Ä–∞—É–∑—ä—Ä –Ω–µ –ø–æ–¥–¥—ä—Ä–∂–∞ –≥–ª–∞—Å–æ–≤–æ –≤—ä–∑–ø—Ä–æ–∏–∑–≤–µ–∂–¥–∞–Ω–µ', 'error');
    }
}

// Enter key shortcut
document.getElementById('textToTranslate').addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
        translateText();
    }
});

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–µ–≤–µ–∂–¥–∞–Ω–µ –ø—Ä–∏ –ø—Ä–æ–º—è–Ω–∞ –Ω–∞ –µ–∑–∏–∫–∞ (–ø–æ –∏–∑–±–æ—Ä)
// document.getElementById('targetLanguage').addEventListener('change', function() {
//     const text = document.getElementById('textToTranslate').value.trim();
//     if (text) {
//         translateText();
//     }
// });
</script>

<style>
.translation-details {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 1rem;
    border-radius: 8px;
    border-left: 4px solid #667eea;
}

.placeholder-text {
    opacity: 0.7;
}

.action-buttons .btn {
    flex: 1;
    min-width: 120px;
}

@media (max-width: 768px) {
    .action-buttons {
        flex-direction: column;
    }

    .action-buttons .btn {
        width: 100%;
    }
}
</style>
{% endblock %}